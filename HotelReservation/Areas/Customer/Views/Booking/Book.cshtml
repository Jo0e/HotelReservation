@model Hotel

@if (Model == null)
{
    <p class="text-danger">Hotel details could not be loaded.</p>
}
else
{
    <div class="hotel-details">
        <h1>@Model.Name</h1>
        <p>@Model.Description</p>
        <img src="~/images/homeImage/@Model.CoverImg" class="img-fluid" alt="Hotel Image">
    </div>

    @if (ViewBag.NearCheckoutRooms != null && ((List<Room>)ViewBag.NearCheckoutRooms).Any())
    {
        <h3>Rooms near checkout:</h3>
        <ul>
            @foreach (var room in (List<Room>)ViewBag.NearCheckoutRooms)
            {
                <li>Room ID: @room.Id - Type: @room.RoomType.Type</li>
            }
        </ul>
    }
    else if (TempData["ErrorMessage"] != null)
    {
        <p class="text-danger">@TempData["ErrorMessage"]</p>
    }
}


<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Display Toastr notifications for TempData
    @if (TempData["ErrorMessage"] != null)
    {
        <text>toastr.error('@TempData["ErrorMessage"]');</text>
    }
    @if (TempData["SuccessMessage"] != null)
    {
        <text>toastr.success('@TempData["SuccessMessage"]');</text>
    }
    });
</script>

<form asp-controller="Booking" asp-action="Book" method="post" class="booking-form">
    @Html.AntiForgeryToken()

    <input type="hidden" name="HotelId" value="@Model.Id" />
    <input type="hidden" name="RoomType" value="@ViewBag.Type.RoomType" />
    <input type="hidden" name="PricePN" value="@ViewBag.Type.PricePN" />
    <input type="hidden" name="MealPrice" value="@ViewBag.Type.MealPrice" />

    <div class="form-group">
        <label for="adults">Number of Adults:</label>
        <input type="number" id="adults" name="NAdult" value="1" min="1" required class="form-control" />
    </div>

    <div class="form-group">
        <label for="children">Number of Children:</label>
        <input type="number" id="children" name="NChildren" value="0" min="0" max="10" class="form-control" onchange="updateChildAgeInputs()" />
    </div>

    <div class="form-group" id="childAgesContainer"></div>

    <div class="form-group">
        <label for="checkInDate">Check-In Date:</label>
        <input type="date" id="checkInDate" name="CheckInDate" value="@DateTime.Now.ToString("yyyy-MM-dd")" required class="form-control" />
    </div>

    <div class="form-group">
        <label for="checkOutDate">Check-Out Date:</label>
        <input type="date" id="checkOutDate" name="CheckOutDate" value="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")" required class="form-control" />
    </div>

    <div class="form-group">
        <label for="meals">Include Meals:</label>
        <select id="meals" name="IncludesMeal" class="form-control">
            <option value="true">Yes</option>
            <option value="false">No</option>
        </select>
    </div>

    <div class="form-group">
        <label for="rooms">Number of Rooms:</label>
        <input type="number" id="rooms" name="RoomCount" value="1" min="1" required class="form-control" />
    </div>

    <div class="form-group">
        <label for="coupon">Have a Coupon?</label>
        <input type="text" id="coupon" name="CouponCode" placeholder="Optional" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Confirm Booking</button>
</form>

<script>
    function updateChildAgeInputs() {
        const numberOfChildren = document.getElementById("children").value;
        const childAgesContainer = document.getElementById("childAgesContainer");
        childAgesContainer.innerHTML = "";

        for (let i = 0; i < numberOfChildren; i++) {
            const input = document.createElement("input");
            input.type = "number";
            input.name = `ChildrenAge[${i}]`;
            input.placeholder = `Age of Child ${i + 1}`;
            input.className = "form-control mt-2";
            input.required = true;
            input.max = 18;
            input.min = 1;
            childAgesContainer.appendChild(input);
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const checkInInput = document.getElementById('checkInDate');
        const checkOutInput = document.getElementById('checkOutDate');
        const form = document.querySelector(".booking-form");

        form.addEventListener("submit", function (event) {
            const checkInDate = new Date(checkInInput.value);
            const checkOutDate = new Date(checkOutInput.value);
            const now = new Date();

            if (checkInDate < now.setHours(0, 0, 0, 0)) {
                toastr.error("Check-In date cannot be in the past.");
                event.preventDefault();
                return false;
            }

            if (checkOutDate <= checkInDate) {
                toastr.error("Check-Out date must be after Check-In date.");
                event.preventDefault();
                return false;
            }
        });
    });
</script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.5.4/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
